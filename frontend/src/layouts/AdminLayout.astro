---
/**
 * Admin Layout - Wrapper for admin pages
 * Includes Bootstrap CSS/JS, theme handling, and common styles
 */
interface Props {
  title?: string;
}

const { title = 'KEA Research Admin' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>

  {/* Prevent theme flash - must run before page renders */}
  <script is:inline>
    (function() {
      var theme = localStorage.getItem('admin-theme') || 'auto';
      var effectiveTheme;
      if (theme === 'dark') {
        effectiveTheme = 'dark';
      } else if (theme === 'light') {
        effectiveTheme = 'light';
      } else {
        effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      document.documentElement.setAttribute('data-bs-theme', effectiveTheme);
      window._adminEffectiveTheme = effectiveTheme;
    })();
  </script>

  {/* Favicons */}
  <link rel="icon" type="image/svg+xml" href="https://cdn.jsdelivr.net/gh/keabase/web@main/dist/img/favicon/favicon.svg">

  {/* Theme Colors */}
  <meta name="theme-color" content="#1A5F6C" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#2B3035" media="(prefers-color-scheme: dark)">

  {/* Bootstrap CSS */}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" integrity="sha256-2FMn2Zx6PuH5tdBQDRNwrOo60ts5wWPC9R8jK67b3t4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" integrity="sha256-pdY4ejLKO67E0CM2tbPtq1DJ3VGDVVdqAR6j3ZwdiE4=" crossorigin="anonymous">

  <style is:global>
    /* Provider card styles */
    .provider-card {
      transition: all 0.2s ease;
    }
    .provider-card:hover {
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .provider-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    .model-badge {
      font-size: 0.75rem;
    }
    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .icon-preview {
      font-size: 1.25rem;
      color: var(--bs-primary);
      min-width: 42px;
      justify-content: center;
    }
    .icon-preview svg {
      fill: var(--bs-primary);
    }
    .icon-preview img {
      width: 1.25rem;
      height: 1.25rem;
      object-fit: contain;
    }

    /* Loading states */
    .loading-spinner {
      display: none;
    }
    .loading .loading-spinner {
      display: inline-block;
    }
    .loading .loading-content {
      display: none;
    }

    /* KEA brand utilities */
    .text-kea{color:#323b1c;}
    [data-bs-theme="dark"] .text-kea{color:#a68d6f;}
    .btn-kea{--btn-bg:#323b1c;--btn-hover:#424d26;background-color:var(--btn-bg);border-color:var(--btn-bg);color:#fff;}
    .btn-kea:hover,.btn-kea:focus{background-color:var(--btn-hover);border-color:var(--btn-hover);color:#fff;}
    .btn-kea:active{background-color:#2a3117;border-color:#2a3117;color:#fff;}
    [data-bs-theme="dark"] .btn-kea{--btn-bg:#a68d6f;--btn-hover:#9a7c5a;color:#1a1a1a;}
    [data-bs-theme="dark"] .btn-kea:hover,[data-bs-theme="dark"] .btn-kea:focus{color:#1a1a1a;}
    [data-bs-theme="dark"] .btn-kea:active{background-color:#897455;border-color:#897455;color:#fff;}
    .btn-outline-kea{--btn-color:#323b1c;--btn-hover-bg:#323b1c;color:var(--btn-color);border-color:var(--btn-color);background-color:transparent;}
    .btn-outline-kea:hover,.btn-outline-kea:focus{background-color:var(--btn-hover-bg);border-color:var(--btn-hover-bg);color:#fff;}
    [data-bs-theme="dark"] .btn-outline-kea{--btn-color:#a68d6f;--btn-hover-bg:#a68d6f;}
    [data-bs-theme="dark"] .btn-outline-kea:hover,[data-bs-theme="dark"] .btn-outline-kea:focus{color:#1a1a1a;}
    .link-kea{color:#323b1c;}.link-kea:hover{color:#424d26;}
    [data-bs-theme="dark"] .link-kea{color:#a68d6f;}[data-bs-theme="dark"] .link-kea:hover{color:#9a7c5a;}
    .bg-kea{background-color:#323b1c !important;}
    [data-bs-theme="dark"] .bg-kea{background-color:#a68d6f !important;}
    .bg-kea-subtle{background-color:rgba(50, 59, 28, 0.15) !important;}
    [data-bs-theme="dark"] .bg-kea-subtle{background-color:rgba(166, 141, 111, 0.2) !important;}

    /* Admin sidebar (future use) */
    .admin-sidebar {
      width: 250px;
      min-height: calc(100vh - 56px);
      border-right: 1px solid var(--bs-border-color);
    }
    .admin-sidebar .nav-link {
      padding: 0.75rem 1rem;
      color: var(--bs-body-color);
      border-left: 3px solid transparent;
    }
    .admin-sidebar .nav-link:hover {
      background-color: var(--bs-tertiary-bg);
    }
    .admin-sidebar .nav-link.active {
      background-color: var(--bs-tertiary-bg);
      border-left-color: var(--bs-primary);
      font-weight: 500;
    }
    .admin-sidebar .nav-link.disabled {
      opacity: 0.5;
    }
  </style>

  <slot name="head" />
</head>
<body>
  <slot name="login" />

  <div id="admin-view" class="d-none">
    <slot name="navbar" />
    <slot />
  </div>

  <slot name="modals" />
  <slot name="toast" />

  {/* Bootstrap JS */}
  <script is:inline src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  {/* Markdown Parser for Release Notes */}
  <script is:inline src="https://cdn.jsdelivr.net/npm/marked@17.0.1/lib/marked.umd.min.js"></script>

  {/* Theme Switching */}
  <script is:inline>
    (function() {
      const STORAGE_KEY = 'admin-theme';

      function applyTheme(theme) {
        let effectiveTheme;
        if (theme === 'dark') {
          effectiveTheme = 'dark';
        } else if (theme === 'light') {
          effectiveTheme = 'light';
        } else {
          effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        document.documentElement.setAttribute('data-bs-theme', effectiveTheme);
        updateThemeIcon(theme);
        updateActiveMenuItem(theme);
        updateLogo(effectiveTheme);
      }

      function updateLogo(effectiveTheme) {
        const logoSrc = effectiveTheme === 'dark'
          ? 'https://cdn.jsdelivr.net/gh/keabase/web@main/dist/img/logo/KEA-research-logo-dark.svg'
          : 'https://cdn.jsdelivr.net/gh/keabase/web@main/dist/img/logo/KEA-research-logo-light.svg';
        ['navbarLogo', 'loginLogo'].forEach(function(id) {
          var logo = document.getElementById(id);
          if (logo) logo.src = logoSrc;
        });
      }

      function updateThemeIcon(theme) {
        const icon = document.getElementById('themeIcon');
        if (!icon) return;
        icon.className = 'bi';
        if (theme === 'light') {
          icon.classList.add('bi-sun');
        } else if (theme === 'dark') {
          icon.classList.add('bi-moon');
        } else {
          icon.classList.add('bi-circle-half');
        }
      }

      function updateActiveMenuItem(theme) {
        document.querySelectorAll('[data-theme]').forEach(function(item) {
          item.classList.toggle('active', item.getAttribute('data-theme') === theme);
        });
      }

      document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem(STORAGE_KEY) || 'auto';
        applyTheme(savedTheme);

        if (window._adminEffectiveTheme) {
          updateLogo(window._adminEffectiveTheme);
        }

        document.querySelectorAll('[data-theme]').forEach(function(item) {
          item.addEventListener('click', function() {
            const theme = this.getAttribute('data-theme');
            localStorage.setItem(STORAGE_KEY, theme);
            applyTheme(theme);
          });
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
          const savedTheme = localStorage.getItem(STORAGE_KEY) || 'auto';
          if (savedTheme === 'auto') {
            applyTheme('auto');
          }
        });
      });
    })();
  </script>

</body>
</html>
